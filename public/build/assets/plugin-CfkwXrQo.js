import{r as n,j as e,a as T}from"./client-DCNturwH.js";const I=()=>{const[r,u]=n.useState(""),[c,v]=n.useState(""),[d,j]=n.useState(""),[o,g]=n.useState(""),[m,p]=n.useState(!1),[y,x]=n.useState(""),[S,f]=n.useState(""),[b,h]=n.useState(!1);n.useEffect(()=>{const t=()=>{window.parent.postMessage({message:"REQUEST_USER_DATA"},"*")},s=i=>{if(i.data?.message==="REQUEST_USER_DATA_RESPONSE"){const N=i.data.payload;fetch("/api/decrypt-context",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedData:N})}).then(l=>l.json()).then(l=>{g(l.locationId),console.log("HighLevel Context:",l)}).catch(l=>{console.error("Error decrypting context:",l),g("test_location_dev")})}};return window.addEventListener("message",s),setTimeout(t,100),()=>window.removeEventListener("message",s)},[]);const a=(t,s)=>{x(t),f(s),setTimeout(()=>{x(""),f("")},5e3)},w=async()=>{if(!r){a("Please enter your Delyva API Key","error");return}h(!0);try{const t=await fetch("/api/credentials/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locationId:o,apiKey:r,customerId:c,apiSecret:d})}),s=await t.json();t.ok&&s.valid===!0?a("✅ Delyva credentials are valid!","success"):a(`❌ ${s.message||s.error_details||"Invalid credentials"}`,"error")}catch(t){a("❌ Error testing credentials","error"),console.error("Test credentials error:",t)}finally{h(!1)}},E=async t=>{if(t.preventDefault(),!r){a("Please enter your Delyva API Key","error");return}if(!o){a("Location ID not found. Please refresh the page.","error");return}p(!0);try{const s=await fetch("/api/credentials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locationId:o,apiKey:r,customerId:c,apiSecret:d})}),i=await s.json();s.ok&&i.status==="success"?a("🎉 API Key saved successfully!","success"):a(`❌ ${i.error||"Failed to save credentials"}`,"error")}catch(s){a("❌ Error saving credentials. Please try again.","error"),console.error("Save credentials error:",s)}finally{p(!1)}};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Delyva Integration"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Enter your Delyva credentials to enable shipping"}),o&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Location: ",o]})]}),y&&e.jsx("div",{className:`mb-4 p-3 rounded-md text-sm ${S==="success"?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"}`,children:y}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delyva API Key *"}),e.jsx("input",{type:"text",value:r,onChange:t=>u(t.target.value),placeholder:"Enter your Delyva API Key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer ID (Optional)"}),e.jsx("input",{type:"text",value:c,onChange:t=>v(t.target.value),placeholder:"Customer ID (will auto-detect if empty)",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"API Secret (Optional)"}),e.jsx("input",{type:"password",value:d,onChange:t=>j(t.target.value),placeholder:"API Secret (if available)",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:w,disabled:b||!r,className:"flex-1 bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:b?"Testing...":"Test Credentials"}),e.jsx("button",{type:"submit",disabled:m||!r||!o,className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:m?"Saving...":"Save"})]})]}),e.jsx("div",{className:"mt-6 text-xs text-gray-500 text-center",children:e.jsx("p",{children:"After saving, Delyva will be registered as a shipping carrier in HighLevel."})})]})})};document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("plugin-root");r?T.createRoot(r).render(e.jsx(I,{})):console.error("Plugin root element not found")});
